loki:
  auth_enabled: false

  storage:
    bucketNames:
      chunks: loki-chunks
      ruler: loki-ruler
      admin: loki-admin
    type: s3
    s3:
      endpoint: http://10.65.67.100
      accessKeyId: ${S3_ACCESS_KEY}
      secretAccessKey: ${S3_SECRET_KEY}
      s3ForcePathStyle: false
      insecure: false
  
  schemaConfig:
    configs:
      - from: 2023-08-01
        store: tsdb
        object_store: {{ .Values.loki.storage.type }}
        schema: v12
        index:
          prefix: loki_index_
          period: 24h

  gateway:
    service:
      type: LoadBalancer
      annotations:
        external-dns.alpha.kubernetes.io/hostname: loki.fmt2.generalprogramming.org

  backend:
    extraArgs:
      - '-config.expand-env=true'
    extraEnv:
      - name: S3_ACCESS_KEY
        valueFrom:
          secretKeyRef:
            name: loki-secrets
            key: s3_access_key
      - name: S3_SECRET_KEY
        valueFrom:
          secretKeyRef:
            name: loki-secrets
            key: s3_secret_key

  read:
    extraArgs:
      - '-config.expand-env=true'
    extraEnv:
      - name: S3_ACCESS_KEY
        valueFrom:
          secretKeyRef:
            name: loki-secrets
            key: s3_access_key
      - name: S3_SECRET_KEY
        valueFrom:
          secretKeyRef:
            name: loki-secrets
            key: s3_secret_key

  write:
    extraArgs:
      - '-config.expand-env=true'
    extraEnv:
      - name: S3_ACCESS_KEY
        valueFrom:
          secretKeyRef:
            name: loki-secrets
            key: s3_access_key
      - name: S3_SECRET_KEY
        valueFrom:
          secretKeyRef:
            name: loki-secrets
            key: s3_secret_key